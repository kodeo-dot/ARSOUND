{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/benii/Downloads/ARSOUND%20-%20DEMO%20WEB/lib/supabase/server-client.ts"],"sourcesContent":["import { createServerClient as createSupabaseServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createServerClient() {\n  const cookieStore = await cookies()\n\n  return createSupabaseServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // Ignore cookie set errors in Server Components\n        }\n      },\n    },\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,4IAAO;IAEjC,OAAO,IAAA,iMAA0B,sUAAoF;QACnH,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,gDAAgD;gBAClD;YACF;QACF;IACF;AACF","debugId":null}},
    {"offset": {"line": 76, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/benii/Downloads/ARSOUND%20-%20DEMO%20WEB/app/api/mercadopago/create-preference/route.ts"],"sourcesContent":["import { createServerClient } from \"@/lib/supabase/server-client\"\nimport { NextResponse } from \"next/server\"\n\nexport async function POST(request: Request) {\n  try {\n    const accessToken = process.env.MERCADO_PAGO_ACCESS_TOKEN\n    const publicKey = process.env.MERCADO_PAGO_PUBLIC_KEY\n\n    if (!accessToken || !publicKey) {\n      console.error(\"[v0] Mercado Pago credentials not configured\")\n      return NextResponse.json(\n        { error: \"Error al crear la preferencia de pago. Revis치 las credenciales de Mercado Pago.\" },\n        { status: 500 },\n      )\n    }\n\n    const supabase = await createServerClient()\n    const {\n      data: { user },\n    } = await supabase.auth.getUser()\n\n    if (!user) {\n      return NextResponse.json({ error: \"No autorizado\" }, { status: 401 })\n    }\n\n    const body = await request.json()\n    const { packId, planType, discountCode } = body\n\n    // Validate required fields\n    if (!packId && !planType) {\n      return NextResponse.json({ error: \"Se requiere packId o planType\" }, { status: 400 })\n    }\n\n    const preferenceData: any = {\n      back_urls: {\n        success: `${process.env.NEXT_PUBLIC_APP_URL}/payment/success`,\n        failure: `${process.env.NEXT_PUBLIC_APP_URL}/payment/failure`,\n        pending: `${process.env.NEXT_PUBLIC_APP_URL}/payment/pending`,\n      },\n      notification_url: `${process.env.NEXT_PUBLIC_APP_URL}/api/webhooks/mercadopago`,\n      auto_return: \"approved\",\n      payer: {\n        email: user.email,\n      },\n    }\n\n    // Handle pack purchase\n    if (packId) {\n      const { data: pack, error: packError } = await supabase\n        .from(\"packs\")\n        .select(\"id, title, price, user_id\")\n        .eq(\"id\", packId)\n        .single()\n\n      if (packError || !pack) {\n        return NextResponse.json({ error: \"Pack no encontrado\" }, { status: 404 })\n      }\n\n      let finalPrice = pack.price\n\n      // Apply discount code if provided\n      if (discountCode) {\n        const { data: discount, error: discountError } = await supabase\n          .from(\"discount_codes\")\n          .select(\"*\")\n          .eq(\"pack_id\", packId)\n          .eq(\"code\", discountCode.toUpperCase())\n          .single()\n\n        if (!discountError && discount) {\n          finalPrice = pack.price * (1 - discount.discount_percent / 100)\n        }\n      }\n\n      preferenceData.items = [\n        {\n          id: pack.id,\n          title: pack.title,\n          quantity: 1,\n          unit_price: finalPrice,\n          currency_id: \"ARS\",\n        },\n      ]\n      preferenceData.external_reference = `pack_${user.id}_${packId}`\n      preferenceData.metadata = {\n        type: \"pack_purchase\",\n        pack_id: packId,\n        buyer_id: user.id,\n        seller_id: pack.user_id,\n        discount_code: discountCode || null,\n      }\n    }\n\n    // Handle plan subscription\n    if (planType) {\n      const planPrices: Record<string, number> = {\n        de_0_a_hit: 5000,\n        studio_plus: 15000,\n      }\n\n      const price = planPrices[planType]\n      if (!price) {\n        return NextResponse.json({ error: \"Plan inv치lido\" }, { status: 400 })\n      }\n\n      preferenceData.items = [\n        {\n          id: planType,\n          title: `Plan ARSOUND - ${planType === \"de_0_a_hit\" ? \"De 0 a Hit\" : \"Studio Plus\"}`,\n          quantity: 1,\n          unit_price: price,\n          currency_id: \"ARS\",\n        },\n      ]\n      preferenceData.external_reference = `plan_${user.id}_${planType}`\n      preferenceData.metadata = {\n        type: \"plan_subscription\",\n        plan_type: planType,\n        user_id: user.id,\n      }\n    }\n\n    try {\n      const response = await fetch(\"https://api.mercadopago.com/checkout/preferences\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${accessToken}`,\n        },\n        body: JSON.stringify(preferenceData),\n      })\n\n      if (!response.ok) {\n        const errorData = await response.json()\n        console.error(\"[v0] Mercado Pago API error:\", response.status, errorData)\n        return NextResponse.json(\n          { error: \"Error al crear la preferencia de pago. Revis치 las credenciales de Mercado Pago.\" },\n          { status: 401 },\n        )\n      }\n\n      const preference = await response.json()\n\n      return NextResponse.json({\n        init_point: preference.init_point,\n        preference_id: preference.id,\n      })\n    } catch (apiError) {\n      console.error(\"[v0] Error calling Mercado Pago API:\", apiError)\n      return NextResponse.json(\n        { error: \"Error al crear la preferencia de pago. Revis치 las credenciales de Mercado Pago.\" },\n        { status: 500 },\n      )\n    }\n  } catch (error) {\n    console.error(\"[v0] Error creating Mercado Pago preference:\", error)\n    return NextResponse.json({ error: \"Error al crear preferencia de pago\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}