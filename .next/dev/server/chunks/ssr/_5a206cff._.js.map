{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 12, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/benii/Downloads/ARSOUND%20-%20DEMO%20WEB/app/plans/actions.ts"],"sourcesContent":["\"use server\"\n\nimport { createServerClient } from \"@/lib/supabase/server-client\"\nimport { PLAN_FEATURES, type PlanType } from \"@/lib/plans\"\nimport { headers } from \"next/headers\"\n\n/**\n * Helper to get the origin URL dynamically from request headers\n */\nasync function getOrigin(): Promise<string> {\n  const headersList = await headers()\n  const host = headersList.get(\"host\") || \"localhost:3000\"\n  const protocol = headersList.get(\"x-forwarded-proto\") || \"http\"\n  return `${protocol}://${host}`\n}\n\n/**\n * Server action to create Mercado Pago preference for plan selection\n * Now fully on server - no fetch call needed\n */\nasync function createMercadoPagoPreference(planType: string) {\n  const accessToken = process.env.MERCADO_PAGO_ACCESS_TOKEN\n  const publicKey = process.env.MERCADO_PAGO_PUBLIC_KEY\n\n  if (!accessToken || !publicKey) {\n    console.error(\"[v0] Mercado Pago credentials not configured\")\n    return { success: false, message: \"Error al configurar el pago. Contacta con soporte.\" }\n  }\n\n  const supabase = await createServerClient()\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  if (!user) {\n    return { success: false, message: \"Por favor inicia sesión para continuar\" }\n  }\n\n  try {\n    const planPrices: Record<string, number> = {\n      de_0_a_hit: 5000,\n      de_0_a_hit_monthly: 5000,\n      studio_plus: 15000,\n      studio_plus_monthly: 15000,\n    }\n\n    const price = planPrices[planType]\n    if (!price) {\n      return { success: false, message: \"Plan inválido\" }\n    }\n\n    const origin = await getOrigin()\n\n    const preferenceData = {\n      back_urls: {\n        success: `${origin}/payment/success`,\n        failure: `${origin}/payment/failure`,\n        pending: `${origin}/payment/pending`,\n      },\n      notification_url: `${origin}/api/webhooks/mercadopago`,\n      auto_return: \"approved\" as const,\n      payer: {\n        email: user.email,\n      },\n      items: [\n        {\n          id: planType,\n          title: `Plan ARSOUND - ${planType.includes(\"de_0\") ? \"De 0 a Hit\" : \"Studio Plus\"}`,\n          quantity: 1,\n          unit_price: price,\n          currency_id: \"ARS\",\n        },\n      ],\n      external_reference: `plan_${user.id}_${planType}`,\n      metadata: {\n        type: \"plan_subscription\",\n        plan_type: planType,\n        user_id: user.id,\n      },\n    }\n\n    const response = await fetch(\"https://api.mercadopago.com/checkout/preferences\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${accessToken}`,\n      },\n      body: JSON.stringify(preferenceData),\n    })\n\n    if (!response.ok) {\n      const errorData = await response.json()\n      console.error(\"[v0] Mercado Pago API error:\", errorData)\n      return { success: false, message: \"Error al crear la preferencia de pago. Revisá las credenciales.\" }\n    }\n\n    const preference = await response.json()\n\n    if (!preference.init_point) {\n      console.error(\"[v0] Mercado Pago response missing init_point:\", preference)\n      return { success: false, message: \"Error al procesar el pago. Intenta de nuevo.\" }\n    }\n\n    return { success: true, init_point: preference.init_point, preferenceId: preference.id }\n  } catch (error) {\n    console.error(\"[v0] Error in createMercadoPagoPreference:\", error)\n    return { success: false, message: \"Error al crear la preferencia de pago\" }\n  }\n}\n\n/**\n * Server action to handle plan selection\n * Creates a Mercado Pago preference and returns checkout URL\n */\nexport async function selectPlan(planId: string) {\n  if (!planId || planId === \"free\") {\n    return { success: false, message: \"Plan inválido\" }\n  }\n\n  return createMercadoPagoPreference(planId)\n}\n\n/**\n * Server action to purchase a pack\n * Creates a Mercado Pago preference for pack purchase\n */\nexport async function purchasePack(packId: string, discountCode?: string) {\n  const supabase = await createServerClient()\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  if (!user) {\n    return { success: false, message: \"Por favor inicia sesión para continuar\" }\n  }\n\n  const accessToken = process.env.MERCADO_PAGO_ACCESS_TOKEN\n  const publicKey = process.env.MERCADO_PAGO_PUBLIC_KEY\n\n  if (!accessToken || !publicKey) {\n    console.error(\"[v0] Mercado Pago credentials not configured\")\n    return { success: false, message: \"Error al configurar el pago. Contacta con soporte.\" }\n  }\n\n  try {\n    const { data: pack, error: packError } = await supabase\n      .from(\"packs\")\n      .select(\"id, title, price, user_id, discount_percent, has_discount\")\n      .eq(\"id\", packId)\n      .single()\n\n    if (packError || !pack) {\n      return { success: false, message: \"Pack no encontrado\" }\n    }\n\n    const { data: sellerProfile, error: sellerError } = await supabase\n      .from(\"profiles\")\n      .select(\"plan\")\n      .eq(\"id\", pack.user_id)\n      .single()\n\n    if (sellerError || !sellerProfile) {\n      return { success: false, message: \"No se pudo obtener información del vendedor\" }\n    }\n\n    const sellerPlan = (sellerProfile.plan as PlanType) || \"free\"\n    const commission = PLAN_FEATURES[sellerPlan].commission\n\n    let finalPrice = pack.price\n    if (pack.has_discount && pack.discount_percent) {\n      finalPrice = Math.floor(pack.price * (1 - pack.discount_percent / 100))\n    }\n\n    const commissionAmount = Math.floor(finalPrice * commission)\n    const sellerEarnings = finalPrice - commissionAmount\n\n    const origin = await getOrigin()\n\n    const preferenceData = {\n      back_urls: {\n        success: `${origin}/payment/success`,\n        failure: `${origin}/payment/failure`,\n        pending: `${origin}/payment/pending`,\n      },\n      notification_url: `${origin}/api/webhooks/mercadopago`,\n      auto_return: \"approved\" as const,\n      payer: {\n        email: user.email,\n      },\n      items: [\n        {\n          id: pack.id,\n          title: pack.title,\n          quantity: 1,\n          unit_price: finalPrice,\n          currency_id: \"ARS\",\n        },\n      ],\n      external_reference: `pack_${user.id}_${packId}`,\n      marketplace_fee: commissionAmount,\n      transfer_data: {\n        amount: sellerEarnings,\n        receiver_account_id: null,\n      },\n      metadata: {\n        type: \"pack_purchase\",\n        pack_id: packId,\n        buyer_id: user.id,\n        seller_id: pack.user_id,\n        seller_plan: sellerPlan,\n        commission_percent: commission,\n        commission_amount: commissionAmount,\n        seller_earnings: sellerEarnings,\n        final_price: finalPrice,\n        discount_percent: pack.has_discount ? pack.discount_percent : 0,\n      },\n    }\n\n    const response = await fetch(\"https://api.mercadopago.com/checkout/preferences\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${accessToken}`,\n      },\n      body: JSON.stringify(preferenceData),\n    })\n\n    if (!response.ok) {\n      const errorData = await response.json()\n      console.error(\"[v0] Mercado Pago API error:\", errorData)\n      return { success: false, message: \"Error al crear la preferencia de pago. Intenta de nuevo.\" }\n    }\n\n    const preference = await response.json()\n\n    if (!preference.init_point) {\n      console.error(\"[v0] No init_point in response:\", preference)\n      return { success: false, message: \"Error al procesar el pago. Intenta de nuevo.\" }\n    }\n\n    return { success: true, init_point: preference.init_point, preferenceId: preference.id }\n  } catch (error) {\n    console.error(\"[v0] Error in purchasePack:\", error)\n    return { success: false, message: \"Error al crear la preferencia de pago\" }\n  }\n}\n"],"names":[],"mappings":";;;;;;;IAkHsB,aAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA","debugId":null}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/benii/Downloads/ARSOUND%20-%20DEMO%20WEB/app/plans/actions.ts"],"sourcesContent":["\"use server\"\n\nimport { createServerClient } from \"@/lib/supabase/server-client\"\nimport { PLAN_FEATURES, type PlanType } from \"@/lib/plans\"\nimport { headers } from \"next/headers\"\n\n/**\n * Helper to get the origin URL dynamically from request headers\n */\nasync function getOrigin(): Promise<string> {\n  const headersList = await headers()\n  const host = headersList.get(\"host\") || \"localhost:3000\"\n  const protocol = headersList.get(\"x-forwarded-proto\") || \"http\"\n  return `${protocol}://${host}`\n}\n\n/**\n * Server action to create Mercado Pago preference for plan selection\n * Now fully on server - no fetch call needed\n */\nasync function createMercadoPagoPreference(planType: string) {\n  const accessToken = process.env.MERCADO_PAGO_ACCESS_TOKEN\n  const publicKey = process.env.MERCADO_PAGO_PUBLIC_KEY\n\n  if (!accessToken || !publicKey) {\n    console.error(\"[v0] Mercado Pago credentials not configured\")\n    return { success: false, message: \"Error al configurar el pago. Contacta con soporte.\" }\n  }\n\n  const supabase = await createServerClient()\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  if (!user) {\n    return { success: false, message: \"Por favor inicia sesión para continuar\" }\n  }\n\n  try {\n    const planPrices: Record<string, number> = {\n      de_0_a_hit: 5000,\n      de_0_a_hit_monthly: 5000,\n      studio_plus: 15000,\n      studio_plus_monthly: 15000,\n    }\n\n    const price = planPrices[planType]\n    if (!price) {\n      return { success: false, message: \"Plan inválido\" }\n    }\n\n    const origin = await getOrigin()\n\n    const preferenceData = {\n      back_urls: {\n        success: `${origin}/payment/success`,\n        failure: `${origin}/payment/failure`,\n        pending: `${origin}/payment/pending`,\n      },\n      notification_url: `${origin}/api/webhooks/mercadopago`,\n      auto_return: \"approved\" as const,\n      payer: {\n        email: user.email,\n      },\n      items: [\n        {\n          id: planType,\n          title: `Plan ARSOUND - ${planType.includes(\"de_0\") ? \"De 0 a Hit\" : \"Studio Plus\"}`,\n          quantity: 1,\n          unit_price: price,\n          currency_id: \"ARS\",\n        },\n      ],\n      external_reference: `plan_${user.id}_${planType}`,\n      metadata: {\n        type: \"plan_subscription\",\n        plan_type: planType,\n        user_id: user.id,\n      },\n    }\n\n    const response = await fetch(\"https://api.mercadopago.com/checkout/preferences\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${accessToken}`,\n      },\n      body: JSON.stringify(preferenceData),\n    })\n\n    if (!response.ok) {\n      const errorData = await response.json()\n      console.error(\"[v0] Mercado Pago API error:\", errorData)\n      return { success: false, message: \"Error al crear la preferencia de pago. Revisá las credenciales.\" }\n    }\n\n    const preference = await response.json()\n\n    if (!preference.init_point) {\n      console.error(\"[v0] Mercado Pago response missing init_point:\", preference)\n      return { success: false, message: \"Error al procesar el pago. Intenta de nuevo.\" }\n    }\n\n    return { success: true, init_point: preference.init_point, preferenceId: preference.id }\n  } catch (error) {\n    console.error(\"[v0] Error in createMercadoPagoPreference:\", error)\n    return { success: false, message: \"Error al crear la preferencia de pago\" }\n  }\n}\n\n/**\n * Server action to handle plan selection\n * Creates a Mercado Pago preference and returns checkout URL\n */\nexport async function selectPlan(planId: string) {\n  if (!planId || planId === \"free\") {\n    return { success: false, message: \"Plan inválido\" }\n  }\n\n  return createMercadoPagoPreference(planId)\n}\n\n/**\n * Server action to purchase a pack\n * Creates a Mercado Pago preference for pack purchase\n */\nexport async function purchasePack(packId: string, discountCode?: string) {\n  const supabase = await createServerClient()\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  if (!user) {\n    return { success: false, message: \"Por favor inicia sesión para continuar\" }\n  }\n\n  const accessToken = process.env.MERCADO_PAGO_ACCESS_TOKEN\n  const publicKey = process.env.MERCADO_PAGO_PUBLIC_KEY\n\n  if (!accessToken || !publicKey) {\n    console.error(\"[v0] Mercado Pago credentials not configured\")\n    return { success: false, message: \"Error al configurar el pago. Contacta con soporte.\" }\n  }\n\n  try {\n    const { data: pack, error: packError } = await supabase\n      .from(\"packs\")\n      .select(\"id, title, price, user_id, discount_percent, has_discount\")\n      .eq(\"id\", packId)\n      .single()\n\n    if (packError || !pack) {\n      return { success: false, message: \"Pack no encontrado\" }\n    }\n\n    const { data: sellerProfile, error: sellerError } = await supabase\n      .from(\"profiles\")\n      .select(\"plan\")\n      .eq(\"id\", pack.user_id)\n      .single()\n\n    if (sellerError || !sellerProfile) {\n      return { success: false, message: \"No se pudo obtener información del vendedor\" }\n    }\n\n    const sellerPlan = (sellerProfile.plan as PlanType) || \"free\"\n    const commission = PLAN_FEATURES[sellerPlan].commission\n\n    let finalPrice = pack.price\n    if (pack.has_discount && pack.discount_percent) {\n      finalPrice = Math.floor(pack.price * (1 - pack.discount_percent / 100))\n    }\n\n    const commissionAmount = Math.floor(finalPrice * commission)\n    const sellerEarnings = finalPrice - commissionAmount\n\n    const origin = await getOrigin()\n\n    const preferenceData = {\n      back_urls: {\n        success: `${origin}/payment/success`,\n        failure: `${origin}/payment/failure`,\n        pending: `${origin}/payment/pending`,\n      },\n      notification_url: `${origin}/api/webhooks/mercadopago`,\n      auto_return: \"approved\" as const,\n      payer: {\n        email: user.email,\n      },\n      items: [\n        {\n          id: pack.id,\n          title: pack.title,\n          quantity: 1,\n          unit_price: finalPrice,\n          currency_id: \"ARS\",\n        },\n      ],\n      external_reference: `pack_${user.id}_${packId}`,\n      marketplace_fee: commissionAmount,\n      transfer_data: {\n        amount: sellerEarnings,\n        receiver_account_id: null,\n      },\n      metadata: {\n        type: \"pack_purchase\",\n        pack_id: packId,\n        buyer_id: user.id,\n        seller_id: pack.user_id,\n        seller_plan: sellerPlan,\n        commission_percent: commission,\n        commission_amount: commissionAmount,\n        seller_earnings: sellerEarnings,\n        final_price: finalPrice,\n        discount_percent: pack.has_discount ? pack.discount_percent : 0,\n      },\n    }\n\n    const response = await fetch(\"https://api.mercadopago.com/checkout/preferences\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${accessToken}`,\n      },\n      body: JSON.stringify(preferenceData),\n    })\n\n    if (!response.ok) {\n      const errorData = await response.json()\n      console.error(\"[v0] Mercado Pago API error:\", errorData)\n      return { success: false, message: \"Error al crear la preferencia de pago. Intenta de nuevo.\" }\n    }\n\n    const preference = await response.json()\n\n    if (!preference.init_point) {\n      console.error(\"[v0] No init_point in response:\", preference)\n      return { success: false, message: \"Error al procesar el pago. Intenta de nuevo.\" }\n    }\n\n    return { success: true, init_point: preference.init_point, preferenceId: preference.id }\n  } catch (error) {\n    console.error(\"[v0] Error in purchasePack:\", error)\n    return { success: false, message: \"Error al crear la preferencia de pago\" }\n  }\n}\n"],"names":[],"mappings":";;;;;;;IA8HsB,eAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA","debugId":null}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/benii/Downloads/ARSOUND%20-%20DEMO%20WEB/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-client-wrapper.ts"],"sourcesContent":["// This file must be bundled in the app's client layer, it shouldn't be directly\n// imported by the server.\n\nexport { callServer } from 'next/dist/client/app-call-server'\nexport { findSourceMapURL } from 'next/dist/client/app-find-source-map-url'\n\n// A noop wrapper to let the Flight client create the server reference.\n// See also: https://github.com/facebook/react/pull/26632\n// eslint-disable-next-line import/no-extraneous-dependencies\nexport { createServerReference } from 'react-server-dom-webpack/client'\n"],"names":["callServer","createServerReference","findSourceMapURL"],"mappings":"AAAA,gFAAgF;AAChF,0BAA0B;;;;;;;;;;;;;;;;IAEjBA,UAAU,EAAA;eAAVA,eAAAA,UAAU;;IAMVC,qBAAqB,EAAA;eAArBA,QAAAA,qBAAqB;;IALrBC,gBAAgB,EAAA;eAAhBA,qBAAAA,gBAAgB;;;+BADE;qCACM;wBAKK","ignoreList":[0],"debugId":null}}]
}